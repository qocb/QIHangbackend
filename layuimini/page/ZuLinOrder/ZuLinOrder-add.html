<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
	<script src="../../js/Cookies.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../lib/jquery-3.4.1/jquery-3.4.1.min.js" type="text/javascript" charset="utf-8"></script>

    <style>
        body {
            background-color: #ffffff;
        }
    </style>
</head>
<body>
	<label class="layui-form-label" style="margin-bottom: 50px;">选择框</label>
	    <div class="layui-input-block">
	      <select class="layui-btn layui-btn-radius layui-btn-primary" name="name" id="sname" lay-verify="required">
	        <option value="">请选择要租赁的商品</option>
	      </select>
		  <button type="button" class="layui-btn layui-btn-normal" onclick="add()">添加</button>
	    </div>
<div class="layui-form layuimini-form">
	
    <table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>
    
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn" id="saveBtn">确认保存</button>
        </div>
    </div>
</div>
<script src="../../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script>
	var all = {};
	var massage={}
    layui.use(['form'], function () {
		
        var form = layui.form,
            layer = layui.layer,
            $ = layui.$;
			
			
			$.ajax({
				url:'https://workspace.cn1.utools.club/TourismLease/api/repertory/queryAll',
				type:'GET',
				data:{
					
					token: getCookie("token"),
					username:getCookie("username"),
				},
				success:function(data){
					if(data.code==0){
						all=data.data;
						data.data.forEach(item=>{
							
							$("#sname").append('<option value="'+item.id+'">'+item.name+'</option>');
						})
					}else{
						alert(data.msg)
					}
					
				}
			})
		

        //监听提交
        form.on('submit(saveBtn)', function (data) {
			
			$.ajax({
				url:'https://workspace.cn1.utools.club/TourismLease/api/tenant/insertOne',
				type:'POST',
				data:{
					name:$("#name").val(),
					phone:$("#phone").val(),
					token: getCookie("token"),
					username:getCookie("username"),
				},
				success:function(data){
					if(data.code==0){
						console.log(data);
					}else{
						alert(data.msg)
					}
					
				}
			})
			
            // var index = layer.alert(JSON.stringify(data.field), {
            //     title: '最终的提交信息'
            // }, function () {

            //     // 关闭弹出层
            //     layer.close(index);

            //     var iframeIndex = parent.layer.getFrameIndex(window.name);
            //     parent.layer.close(iframeIndex);

            // });
			//选完文件后不自动上传
			 //  upload.render({
			 //    elem: '#test8'
			 //    ,url: 'https://workspace.cn1.utools.club/TourismLease/api/tenant/insertOne' //改成您自己的上传接口
			 //    ,auto: false
			 //    ,multiple: true,
				// data:{
				// 	data
				// }
			 //    ,bindAction: '#test9'
			 //    ,done: function(res){
			 //      layer.msg('上传成功');
			 //      console.log(res)
			 //    }
			 //  });
            return false;
        });

    });
	
	
	
	layui.use(['form', 'table'], function () {
		
	    var $ = layui.jquery,
	        form = layui.form,
	        table = layui.table;
			
			
			
			
	    table.render({
	        elem: '#currentTableId',
			loading:false,
	        data:massage,
			
	        cols: [[
	          
	            {field: 'id',  title: 'ID', sort: true},
	           
	           
				{field: 'name',  title: '租赁时间', sort: true},
				{field: 'count',  title: '结束时间', sort: true},
				{field: 'money',  title: '押金', sort: true},
				{field: 'unitdeposit',  title: '租金', sort: true},
			{field: 'unitprice',  title: '租金', sort: true},
		
	            {title: '操作',  toolbar: '#currentTableBar', align: "center"}
	        ]],
			
	        limits: [10, 15, 20, 25, 50, 100],
	        limit: 5,
	        page: true,
	        skin: 'line',
			even:true,
	    });
	
		
		
		
	    /**
	     * toolbar监听事件
	     */
	    table.on('toolbar(currentTableFilter)', function (obj) {
	        if (obj.event === 'add') {  // 监听添加操作
	            var index = layer.open({
	                title: '添加租赁用户',
	                type: 2,
	                shade: 0.2,
	                maxmin:true,
	                shadeClose: true,
	                area: ['100%', '100%'],
	                content: 'ZuLinOrder-add.html',
	            });
	            $(window).on("resize", function () {
	                layer.full(index);
	            });
	        } else if (obj.event === 'delete') {  // 监听删除操作
	            var checkStatus = table.checkStatus('currentTableId')
	                , data = checkStatus.data;
	            layer.alert(JSON.stringify(data));
				
	        }
	    });
	
			table.reload('currentTableId', {
			  data:massage
			});
	
	
	    //监听表格复选框选择
	    table.on('checkbox(currentTableFilter)', function (obj) {
	        console.log(obj)
	    });
	
	    table.on('tool(currentTableFilter)', function (obj) {
	        var data = obj.data;
			console.log(data);
	        if (obj.event === 'delete') {
	            layer.confirm('真的移除行么', function (index) {
	                obj.del();
	                layer.close(index);
					
	            });
	        }
			
			
	    });
	
	});
	
	
	
	function add(){
		console.log(all);
		var id = $("#sname").val();
		all.forEach(item=>{
			if(item.id==id){
				massage=item;
			}
		})
		console.log(massage);
	}
	
	
	
	
	
	
	
	
</script>
</body>
</html>